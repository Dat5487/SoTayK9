<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>S·ªï tay ch√≥ nghi·ªáp v·ª•</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <!-- Login Page Container -->
    <div id="loginPage" class="login-page-container">
        <div class="login-background">
            <!-- Main Title -->
            <h1 class="login-main-title">S·ªî TAY QU·∫¢N L√ù CH√ì NGHI·ªÜP V·ª§ H·∫¢I QUAN</h1>

            <div class="login-content-wrapper">
                <!-- Left Image Grid -->
                <div class="login-image-grid">
                    <div class="grid-item large-item">
                        <img src="{{ url_for('static', filename='images/Ho·∫°t ƒë·ªông h·∫£i quan 1.jpg') }}" alt="Ho·∫°t ƒë·ªông h·∫£i quan 1">
                    </div>
                    <div class="grid-item">
                        <img src="{{ url_for('static', filename='images/Ho·∫°t ƒë·ªông h·∫£i quan 2.jpg') }}" alt="Ho·∫°t ƒë·ªông h·∫£i quan 2">
                    </div>
                    <div class="grid-item">
                        <img src="{{ url_for('static', filename='images/Ho·∫°t ƒë·ªông h·∫£i quan 3.jpg') }}" alt="Ho·∫°t ƒë·ªông h·∫£i quan 3">
                    </div>
                    <div class="grid-item">
                        <img src="{{ url_for('static', filename='images/Ho·∫°t ƒë·ªông h·∫£i quan 4.jpg') }}" alt="Ho·∫°t ƒë·ªông h·∫£i quan 4">
                    </div>
                    <div class="grid-item">
                        <img src="{{ url_for('static', filename='images/Ho·∫°t ƒë·ªông h·∫£i quan 5.jpg') }}" alt="Ho·∫°t ƒë·ªông h·∫£i quan 5">
                    </div>
                </div>

                <!-- Login Form Area -->
                <div class="login-form-area">
                    <div class="login-card">
                        <img src="{{ url_for('static', filename='images/logo-haiquan.png.jpg') }}" alt="Logo C·ª•c H·∫£i Quan" class="login-logo">
                        <h2 class="login-card-title">C·ª§C H·∫¢I QUAN</h2>
                        <p class="login-card-subtitle">B·∫¢O V·ªÜ L·ª¢I √çCH CH·ª¶ QUY·ªÄN QU·ªêC GIA</p>

                        <div class="input-group">
                            <label for="username"><img src="{{ url_for('static', filename='images/user_icon.png') }}" alt="User Icon"></label>
                            <input type="text" id="username" placeholder="T√™n ng∆∞·ªùi d√πng">
                        </div>
                        <div class="input-group">
                            <label for="password"><img src="{{ url_for('static', filename='images/lock_icon.png') }}" alt="Lock Icon"></label>
                            <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
                            <span class="password-toggle" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
                        </div>
                        <button class="login-button" onclick="login()">ƒêƒÉng nh·∫≠p</button>
                        <p class="version-text">Phi√™n b·∫£n 2.0.0</p>
                        <div class="login-links">
                            <a href="#" onclick="showAdminLogin()">üîß Qu·∫£n tr·ªã vi√™n</a>
                            <span>|</span>
                            <a href="#">T√†i li·ªáu h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application Container (initially hidden) -->
    <div id="mainApp" class="main-app-container hidden">
        <div class="top-page-header">
            <img src="{{ url_for('static', filename='images/logo-haiquan.png.jpg') }}" alt="Logo H·∫£i quan" class="header-logo" />
            <h1 class="header-title">S·ªî TAY CH√ì NGHI·ªÜP V·ª§</h1>
            <img src="{{ url_for('static', filename='images/mongcai-bg.jpg.png') }}" alt="H·∫£i quan M√≥ng C√°i" class="header-img" />
        </div>

        <div class="navigation-bar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a..."
                    onkeypress="if(event.key==='Enter') performSearch()">
                <span onclick="performSearch()">üîç</span>
            </div>

            <div class="buttons-right">
                <button onclick="chatWithAI()">Tra c·ª©u AI</button>
                <!-- NEW: Th√™m n√∫t g·ª≠i duy·ªát -->
                <button onclick="submitForApproval()" style="background-color: #28a745;">G·ª≠i duy·ªát</button>
                <button onclick="showAdminLogin()">Qu·∫£n tr·ªã</button>
            </div>
        </div>
        
        <div class="app-container">
            <div class="sidebar">
                <ul>
                    <li onclick="showContent('T·ªîNG QUAN')">T·ªîNG QUAN</li>
                    <li>
                        <span onclick="toggleSubMenu()" style="cursor: pointer;">H·ªí S∆† QU·∫¢N L√ù CH√ì NGHI·ªÜP V·ª§</span>
                        <ul id="dog-sub-menu" class="sub-menu">
                            <li class="sub-item" onclick="showDogProfileForm('CNV BI')">üê∂CNV BI</li>
                            <li class="sub-item" onclick="showDogProfileForm('CNV LU')">üê∂CNV LU</li>
                            <li class="sub-item" onclick="showDogProfileForm('CNV R·∫æCH')">üê∂CNV R·∫æCH</li>
                            <li class="sub-item" onclick="showDogProfileForm('CNV KY')">üê∂CNV KY</li>
                            <li class="sub-item" onclick="showDogProfileForm('CNV REX')">üê∂CNV REX</li>
                            <li class="sub-item" onclick="console.log('Ch·ª©c nƒÉng Th√™m ch√≥ m·ªõi s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t sau.')">‚ûï Th√™m ch√≥ m·ªõi</li>
                        </ul>
                    </li>
                    <li onclick="showContent('QUY TR√åNH CHƒÇM S√ìC')">QUY TR√åNH CHƒÇM S√ìC</li>
                    <li onclick="showContent('QUY TR√åNH S·ª¨ D·ª§NG')">QUY TR√åNH S·ª¨ D·ª§NG</li>
                    <li>
                        <span onclick="toggleJournalMenu()" style="cursor: pointer;">S·ªî NH·∫¨T K√ù HU·∫§N LUY·ªÜN</span>
                        <ul id="journal-sub-menu" class="sub-menu">
                            <li class="sub-item" onclick="showJournalEditForm('CNV BI')">CNV BI</li>
                            <li class="sub-item" onclick="showJournalEditForm('CNV LU')">CNV LU</li>
                            <li class="sub-item" onclick="showJournalEditForm('CNV R·∫æCH')">CNV R·∫æCH</li>
                            <li class="sub-item" onclick="showJournalEditForm('CNV KY')">CNV KY</li>
                            <li class="sub-item" onclick="showJournalEditForm('CNV REX')">CNV REX</li>
                        </ul>
                    </li>

                    <li onclick="showContent('QUY TR√åNH HU·∫§N LUY·ªÜN')">QUY TR√åNH HU·∫§N LUY·ªÜN</li>
                    <li onclick="showContent('VIDEO H∆Ø·ªöNG D·∫™N')">VIDEO H∆Ø·ªöNG D·∫™N</li>
                </ul>
            </div>
            <div class="main-content-area">
                <div class="title-bar">
                    <h1 id="title">T·ªîNG QUAN</h1>
                    <button id="toggleReadButton" onclick="toggleSpeech()">üîä ƒê·ªçc n·ªôi dung</button>
                </div>
                <div class="content-wrapper">
                    <div id="content"></div>
                    <div id="searchResults" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Modal for submission confirmation -->
    <div id="submitModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>üéØ G·ª≠i nh·∫≠t k√Ω duy·ªát</h3>
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën g·ª≠i nh·∫≠t k√Ω n√†y cho l√£nh ƒë·∫°o duy·ªát kh√¥ng?</p>
            <div class="modal-buttons">
                <button onclick="confirmSubmission()" class="btn-confirm">‚úÖ X√°c nh·∫≠n g·ª≠i</button>
                <button onclick="closeModal()" class="btn-cancel">‚ùå H·ªßy</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}" defer></script>
    
    <!-- NEW: Add backend connection script -->
    <script>
        // NEW FUNCTIONS for backend connection
        function showAdminLogin() {
            window.open('/admin', '_blank');
        }

        function submitForApproval() {
            document.getElementById('submitModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('submitModal').style.display = 'none';
        }

        function confirmSubmission() {
            const currentDog = currentDogForJournal || 'CNV BI';
            const journalDate = document.getElementById('journal_date')?.value || new Date().toISOString().slice(0, 10);
            const trainerName = hlvInfo.name || 'Hu·∫•n luy·ªán vi√™n';
            
            // Get all journal data from current form
            const journalData = collectAllJournalData();
            
            fetch('/api/journals/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dog_name: currentDog,
                    date: journalDate,
                    trainer_name: trainerName,
                    journal_data: journalData
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ ' + data.message);
                    closeModal();
                } else {
                    alert('‚ùå ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‚ùå C√≥ l·ªói x·∫£y ra khi g·ª≠i nh·∫≠t k√Ω.');
            });
        }

        function collectAllJournalData() {
            // Collect all current form data
            const data = {
                generalInfo: {
                    date: document.getElementById('journal_date')?.value || new Date().toISOString().slice(0, 10),
                    dog: currentDogForJournal || 'CNV BI',
                    trainer: hlvInfo.name || 'Hu·∫•n luy·ªán vi√™n'
                },
                training: {
                    comment: document.getElementById('journal_hlv_comment')?.value || ''
                },
                care: {
                    lunchTime: document.getElementById('lunchTime')?.value || '',
                    dinnerTime: document.getElementById('dinnerTime')?.value || '',
                    healthStatus: document.querySelector('input[name="health_status"]:checked')?.value || 'B√¨nh th∆∞·ªùng',
                    otherIssues: document.getElementById('journal_other_issues')?.value || ''
                },
                approval: {
                    status: 'submitted',
                    submitted_at: new Date().toISOString()
                }
            };
            return data;
        }

        // Add modal styles
        const modalStyle = document.createElement('style');
        modalStyle.textContent = `
            .modal {
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.4);
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .modal-content {
                background-color: #fefefe;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                text-align: center;
                max-width: 400px;
                width: 90%;
            }
            .modal-buttons {
                margin-top: 20px;
                display: flex;
                gap: 10px;
                justify-content: center;
            }
            .btn-confirm {
                background-color: #28a745;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
            }
            .btn-cancel {
                background-color: #dc3545;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
            }
        `;
        document.head.appendChild(modalStyle);
    </script>
</body>
</html>